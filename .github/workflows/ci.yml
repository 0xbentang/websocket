name: ci
on: [push]

jobs:
  fmt:
    runs-on: ubuntu-latest
    container: docker://nhooyr/websocket-ci@sha256:6f6a00284eff008ad2cece8f3d0b4a2a3a8f2fcf7a54c691c64a92403abc4c75
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - run: ./ci/fmt.sh
  lint:
    runs-on: ubuntu-latest
    container: docker://nhooyr/websocket-ci@sha256:6f6a00284eff008ad2cece8f3d0b4a2a3a8f2fcf7a54c691c64a92403abc4c75
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - run: ./ci/lint.sh
  test:
    runs-on: ubuntu-latest
    container: docker://nhooyr/websocket-ci@sha256:6f6a00284eff008ad2cece8f3d0b4a2a3a8f2fcf7a54c691c64a92403abc4c75
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - run: ./ci/test.sh
        env:
          CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
  wasm:
    runs-on: ubuntu-latest
    container: docker://nhooyr/websocket-ci@sha256:6f6a00284eff008ad2cece8f3d0b4a2a3a8f2fcf7a54c691c64a92403abc4c75
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - run: ./ci/wasm.sh
